<!DOCTYPE html>
<html lang="fr">

<head>
	<META NAME=”robots” CONTENT=”noindex”>
	<meta charset="utf-8">
	<title>Menu Editor</title>
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="editor.css">
</head>

<div class="code-editor-container">
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
	<textarea class="code-editor code-editor-background" id="in" spellcheck="false"></textarea>
	<div class="code-editor code-editor-foreground" id="out" spellcheck="false"></div>
</div>

<script>
	function myFunction() {
			// Get the text field
			var copyText = document.getElementById("in");

			// Select the text field
			copyText.select();
			copyText.setSelectionRange(0, 99999); // For mobile devices

			// Copy the text inside the text field
			navigator.clipboard.writeText(copyText.value);

			// Alert the copied text
			alert("Copied the text: " + copyText.value);
		}
</script>

<script>
	async function initMenu() {
		let response = await fetch('menu.menu');
		let menuFile = await response.text();
		menuFile = menuFile.replace(/(\r\n)/gm, "\n"); //set \n as delimiter by replacing \r\n
		menuFile = menuFile.replace(/(\r)/gm, "\n"); //set \n as delimiter by replacing \r
		document.getElementById('in').innerHTML = menuFile;
		updateScreen(menuFile);
	}
</script>

<script>initMenu()</script>

<script>
	updateScreen($("#in").val());
	$("#in").on("keydown", function (e) {
		setTimeout(() => {
			updateScreen($(this).val());
		}, 0)
	})
	async function updateScreen(text) {
		var text1 = await colorize(text);
		var text2 = await text1.replace(/\n/g, "<br>");
		var text3 = await text2.replace(/\t/g, "&#9;");
		$("#out").html(text3);
	}
	$("#in").on('scroll', function () {
		// set out to be the same as in
		$("#out").css({ top: -$(this).scrollTop() + "px" });
	});
	function colorize(text) {
		var res = "";
		var colors = [
			`<span style="color:white; font-weight:bold">`,
			`<span style="color:grey; font-weight:bold">`,
			`<span style="color:orange">`,
			`<span style="color:grey">`,
			`<span style="color:Khaki">`,
			`<span style="color:grey">`,
			`<span style="color:lightCoral">`,
			`<span style="color:red; font-weight:bold">`,
			`<span style="color:LightSlateGray">`,
			`<span style="color:grey">`,
			`<span style="color:pink">`,
			`<span style="color:grey">`];
		var lines = text.split('\n');
		for (var i = 0; i < lines.length; i++) {
			if (lines[i][0] == '/' && lines[i][1] == '/') {
				res += `<span style="color:black">` + lines[i] + "</span>";
			}
			else {
				blocks = lines[i].split('_');
				for (var j = 0; j < blocks.length; j++) {
					var block = blocks[j];
					//block = block.padEnd(10, ' ').slice(0, 10);
					if (j >= colors.length)
						res += `<span style="color:red; font-weight:bold">` + block + "</span>";
					else
						res += colors[j] + block + "</span>";
					if (j < blocks.length - 1)
						res += `<span style="color:dimGrey">` + '_' + "</span>";
				}
			}
			if (i < lines.length - 1)
				res += '\n';
		}
		return res
	}
</script>

<button onclick="myFunction()">Copy text</button>

</html>